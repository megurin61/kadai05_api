<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»è¨³æ©Ÿèƒ½ä»˜ããƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .remove:hover {
            background: #7fffd4;
        }
    </style>
    <!-- jQueryã®èª­ã¿è¾¼ã¿ -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>

    <h1 id="title">ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</h1>
    <!-- è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ -->
    <button id="btn-ja">æ—¥æœ¬èª</button>
    <button id="btn-en">English</button>

    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
    <div>
        <div>
            <input type="text" id="uname" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
        </div>
        <div>
            <textarea id="text" placeholder="æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
        </div>
        <button id="send">é€ä¿¡</button>
        <div id="output"></div>
    </div>

    <script type="module">
        // Firebaseã®è¨­å®šã¨åˆæœŸåŒ–
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, push, set, remove, onChildAdded, onChildRemoved } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "enter my own key",
  authDomain: "chat-3975e.firebaseapp.com",
  databaseURL: "https://chat-3975e-default-rtdb.firebaseio.com",
  projectId: "chat-3975e",
  storageBucket: "chat-3975e.appspot.com",
  messagingSenderId: "51955708754",
  appId: "1:51955708754:web:9d1a75d6428ddf74ba408b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const dbRef = ref(db, "chat");

        // DeepL API URL and Key
        const deepLApiUrl = "https://api-free.deepl.com/v2/translate";
        const deepLApiKey = "enter my own key";  // Replace with your DeepL API Key

        // Function to translate text
        function translateText(text, targetLang, callback) {
            $.ajax({
                url: deepLApiUrl,
                type: "POST",
                data: {
                    auth_key: deepLApiKey,
                    text: text,
                    target_lang: targetLang
                },
                success: function(response) {
                    callback(response.translations[0].text);
                },
                error: function() {
                    alert("Translation failed.");
                    callback(text);  // Fallback to original text if translation fails
                }
            });
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ™‚
        $("#send").on("click", function () {
            const uname = $("#uname").val();
            const text = $("#text").val();

            // Detect language and set target language for translation
            let targetLang = "EN";  // Default target language is English
            if (/[\u3040-\u30FF\u3400-\u4DBF\u4E00-\u9FFF]/.test(text)) {
                targetLang = "EN";  // Translate from Japanese to English
            } else {
                targetLang = "JA";  // Translate from English to Japanese
            }

            // Translate text before saving to Firebase
            translateText(text, targetLang, function(translatedText) {
                const msg = {
                    uname: uname,
                    original: text,
                    translated: translatedText
                };
                const newPostRef = push(dbRef);
                set(newPostRef, msg);

                // Clear the input field
                $("#text").val('');
            });
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿½åŠ ã•ã‚ŒãŸã¨ã
        onChildAdded(dbRef, function (data) {
            const msg = data.val();
            const key = data.key;
            let h = `<p id="${key}"><strong>${msg.uname}</strong><br>`;
            h += `<span>Original: ${msg.original}</span><br>`;
            h += `<span>Translated: ${msg.translated}</span>`;
            h += `<span class="remove" data-key="${key}"> ğŸš®</span></p>`;
            $("#output").prepend(h);
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‰Šé™¤æ™‚
        $("#output").on("click", ".remove", function () {
            const key = $(this).attr("data-key");
            const removeItem = ref(db, "chat/" + key);
            remove(removeItem);
        });

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‰Šé™¤ã•ã‚ŒãŸã¨ã
        onChildRemoved(dbRef, function (data) {
            $("#" + data.key).remove();
        });

        // è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        const translations = {
            en: {
                title: "Chat App",
                namePlaceholder: "Enter your name",
                textPlaceholder: "Enter your message",
                sendButton: "Send"
            },
            ja: {
                title: "ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª",
                namePlaceholder: "åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
                textPlaceholder: "æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
                sendButton: "é€ä¿¡"
            }
        };

        function translateTo(lang) {
            $("#title").text(translations[lang].title);
            $("#uname").attr("placeholder", translations[lang].namePlaceholder);
            $("#text").attr("placeholder", translations[lang].textPlaceholder);
            $("#send").text(translations[lang].sendButton);
        }

        // æ—¥æœ¬èªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        $("#btn-ja").on("click", function() {
            translateTo("ja");
        });

        // è‹±èªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        $("#btn-en").on("click", function() {
            translateTo("en");
        });
    </script>
</body>
</html>
